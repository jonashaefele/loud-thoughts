# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

LoudThoughts Plugin - A sync service connecting Obsidian notes to AudioPen, VoiceNotes, and Alfie via Firebase real-time sync.

## Architecture

Monorepo structure with yarn workspaces:
- `plugin/` - Obsidian plugin (TypeScript, Vite build)
- `functions/` - Firebase Cloud Functions (Node.js 18)
- `web/` - Web dashboard (SolidJS + TailwindCSS)
- `shared/` - Shared types and Firebase config

## Development Commands

### Plugin Development
```bash
cd plugin
yarn build          # Build plugin to dist/
```

### Firebase Functions
```bash
cd functions
yarn build          # Compile TypeScript
yarn serve          # Local development with emulators
yarn deploy         # Deploy to Firebase
yarn logs           # View function logs
```

### Web Dashboard
```bash
cd web
yarn dev            # Development server
yarn build          # Production build
yarn serve          # Preview build
```

### Code Quality
```bash
yarn lint           # Run ESLint across all workspaces (from root)
```

## Key Files and Entry Points

- **Plugin Entry**: `plugin/main.ts` - Core plugin logic with Firebase listeners
- **Settings UI**: `plugin/ui/SettingsTab.ts` - User configuration interface
- **Firebase Functions**: `functions/src/index.ts` - Webhook endpoint and auth
- **Web App**: `web/src/App.tsx` - Dashboard for webhook URL generation
- **Plugin Manifest**: `plugin/manifest.json` - Obsidian plugin metadata
- **Build Config**: `plugin/vite.config.js` - Custom Vite configuration for plugin build

## Development Patterns

1. **Firebase Real-time Sync**: Plugin listens to Firebase Realtime Database at `/users/{userId}/buffer/` for new notes
2. **Template System**: Templates use variable substitution (e.g., `{{note}}`, `{{date}}`, `{{tags}}`)
3. **Error Handling**: Use Obsidian's `Notice` for user notifications
4. **Status Updates**: Update status bar during sync operations
5. **TypeScript**: Strict typing with shared interfaces in `shared/` workspace

## Firebase Configuration

- **Region**: europe-west1
- **Authentication**: Custom tokens generated by Cloud Functions
- **Database Structure**: `/users/{userId}/buffer/` for note sync
- **Emulators**: Configured for local development (auth, functions, database, hosting)

## Important Notes

- Always build plugin with `yarn build` in the plugin directory before testing
- Firebase functions use Node.js 18 runtime
- Web dashboard is hosted at https://loudthoughts.cloud
- Plugin supports AudioPen, VoiceNotes, and Alfie services
- No test suite - rely on ESLint and manual testing